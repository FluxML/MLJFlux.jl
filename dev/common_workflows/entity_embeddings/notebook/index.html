<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Entity Embeddings · MLJFlux</title><meta name="title" content="Entity Embeddings · MLJFlux"/><meta property="og:title" content="Entity Embeddings · MLJFlux"/><meta property="twitter:title" content="Entity Embeddings · MLJFlux"/><meta name="description" content="Documentation for MLJFlux."/><meta property="og:description" content="Documentation for MLJFlux."/><meta property="twitter:description" content="Documentation for MLJFlux."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&amp;family=Montserrat:ital,wght@0,100..900;1,100..900&amp;display=swap" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.gif" alt="MLJFlux logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">MLJFlux</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">Introduction</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Interface</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../interface/Summary/">Summary</a></li><li><a class="tocitem" href="../../../interface/Builders/">Builders</a></li><li><a class="tocitem" href="../../../interface/Custom Builders/">Custom Builders</a></li><li><a class="tocitem" href="../../../interface/Classification/">Classification</a></li><li><a class="tocitem" href="../../../interface/Regression/">Regression</a></li><li><a class="tocitem" href="../../../interface/Multitarget Regression/">Multi-Target Regression</a></li><li><a class="tocitem" href="../../../interface/Image Classification/">Image Classification</a></li><li><a class="tocitem" href="../../../interface/Entity Embeddings/">Entity Embeddings</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Common Workflows</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../incremental_training/notebook/">Incremental Training</a></li><li class="is-active"><a class="tocitem" href>Entity Embeddings</a></li><li><a class="tocitem" href="../../hyperparameter_tuning/notebook/">Hyperparameter Tuning</a></li><li><a class="tocitem" href="../../composition/notebook/">Model Composition</a></li><li><a class="tocitem" href="../../comparison/notebook/">Model Comparison</a></li><li><a class="tocitem" href="../../early_stopping/notebook/">Early Stopping</a></li><li><a class="tocitem" href="../../live_training/notebook/">Live Training</a></li><li><a class="tocitem" href="../../architecture_search/notebook/">Neural Architecture Search</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Extended Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../extended_examples/MNIST/notebook/">MNIST Images</a></li><li><a class="tocitem" href="../../../extended_examples/spam_detection/notebook/">Spam Detection with RNNs</a></li></ul></li><li><a class="tocitem" href="../../../contributing/">Contributing</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Common Workflows</a></li><li class="is-active"><a href>Entity Embeddings</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Entity Embeddings</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/FluxML/MLJFlux.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/FluxML/MLJFlux.jl/blob/dev/docs/src/common_workflows/entity_embeddings/notebook.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Entity-Embeddings-with-MLJFlux"><a class="docs-heading-anchor" href="#Entity-Embeddings-with-MLJFlux">Entity Embeddings with MLJFlux</a><a id="Entity-Embeddings-with-MLJFlux-1"></a><a class="docs-heading-anchor-permalink" href="#Entity-Embeddings-with-MLJFlux" title="Permalink"></a></h1><p>This demonstration is available as a Jupyter notebook or julia script <a href="https://github.com/FluxML/MLJFlux.jl/tree/dev/docs/src/common_workflows/entity_embeddings">here</a>.</p><p>Entity embedding is newer deep learning approach for categorical encoding introduced in 2016 by Cheng Guo and Felix Berkhahn. It employs a set of embedding layers to map each categorical feature into a dense continuous vector in a similar fashion to how they are employed in NLP architectures.</p><p>In MLJFlux, the <code>NeuralNetworkClassifier</code>, <code>NeuralNetworkRegressor</code>, and the <code>MultitargetNeuralNetworkRegressor</code>` can be trained and evaluated with heterogenous data (i.e., containing categorical features) because they have a built-in entity embedding layer. Moreover, they now offer a transform which encode the categorical features with the learnt embeddings to be used by an upstream machine learning model.</p><p>In this notebook, we will explore how to use entity embeddings in MLJFlux models.</p><p><strong>Julia version</strong> is assumed to be 1.10.*</p><h3 id="Basic-Imports"><a class="docs-heading-anchor" href="#Basic-Imports">Basic Imports</a><a id="Basic-Imports-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Imports" title="Permalink"></a></h3><pre><code class="language-julia hljs">using MLJ
using Flux
using Optimisers
using CategoricalArrays
using DataFrames
using Random
using Tables
using ProgressMeter
using Plots
using ScientificTypes</code></pre><p>Generate some data</p><pre><code class="language-julia hljs">X, y = make_blobs(1000, 2; centers=2, as_table=true, rng=40)
X = DataFrame(X);</code></pre><p>Visualize it</p><pre><code class="language-julia hljs">X_class0 = X[y .== 1, :]
X_class1 = X[y .== 2, :]

p = plot()

scatter!(p, X_class0[!, 1], X_class0[!, 2], markercolor=:blue, label=&quot;Class 0&quot;)
scatter!(p, X_class1[!, 1], X_class1[!, 2], markercolor=:red, label=&quot;Class 1&quot;)

title!(p, &quot;Classes in Different Colors&quot;)
xlabel!(&quot;Feature 1&quot;)
ylabel!(&quot;Feature 2&quot;)

plot(p)</code></pre><img src="cf38ad22.svg" alt="Example block output"/><p>Let&#39;s write a function that creates categorical features C1 and C2 from x1 and x2 in a meaningful way:</p><pre><code class="language-julia hljs">Random.seed!(40)
generate_C1(x1) = (x1 &gt; mean(X.x1) ) ? rand([&#39;A&#39;, &#39;B&#39;])  : rand([&#39;C&#39;, &#39;D&#39;])
generate_C2(x2) = (x2 &gt; mean(X.x2) ) ? rand([&#39;X&#39;, &#39;Y&#39;])  : rand([&#39;Z&#39;])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">generate_C2 (generic function with 1 method)</code></pre><p>Generate C1 and C2 columns</p><pre><code class="language-julia hljs">X[!, :C1] = [generate_C1(x) for x in X[!, :x1]]
X[!, :C2] = [generate_C2(x) for x in X[!, :x2]]
X[!, :R3] = rand(1000);  # A random continuous column.</code></pre><p>Form final dataset using categorical and continuous columns</p><pre><code class="language-julia hljs">X = X[!, [:C1, :C2, :R3]];</code></pre><p>It&#39;s also necessary to cast the categorical columns to the correct scientific type as the embedding layer will have an effect on the model if and only if categorical columns exist.</p><pre><code class="language-julia hljs">X = coerce(X, :C1 =&gt;Multiclass, :C2 =&gt;Multiclass);</code></pre><p>Split the data</p><pre><code class="language-julia hljs">(X_train, X_test), (y_train, y_test) = partition(
	(X, y),
	0.8,
	multi = true,
	shuffle = true,
	stratify = y,
	rng = Random.Xoshiro(41)
);</code></pre><h3 id="Build-MLJFlux-Model"><a class="docs-heading-anchor" href="#Build-MLJFlux-Model">Build MLJFlux Model</a><a id="Build-MLJFlux-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Build-MLJFlux-Model" title="Permalink"></a></h3><pre><code class="language-julia hljs">NeuralNetworkClassifier = @load NeuralNetworkClassifier pkg = MLJFlux


clf = MLJFlux.NeuralNetworkBinaryClassifier(
    builder = MLJFlux.Short(n_hidden = 5),
    optimiser = Optimisers.Adam(0.01),
    batch_size = 2,
    epochs = 100,
    acceleration = CUDALibs(),
    embedding_dims =  Dict(:C1 =&gt; 2, :C2 =&gt; 2,),
);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[ Info: For silent loading, specify `verbosity=0`.
import MLJFlux ✔
┌ Warning: No functional GPU backend found! Defaulting to CPU.
│
│ 1. If no GPU is available, nothing needs to be done. Set `MLDATADEVICES_SILENCE_WARN_NO_GPU=1` to silence this warning.
│ 2. If GPU is available, load the corresponding trigger package.
│     a. `CUDA.jl` and `cuDNN.jl` (or just `LuxCUDA.jl`) for  NVIDIA CUDA Support.
│     b. `AMDGPU.jl` for AMD GPU ROCM Support.
│     c. `Metal.jl` for Apple Metal GPU Support. (Experimental)
│     d. `oneAPI.jl` for Intel oneAPI GPU Support. (Experimental)
└ @ MLDataDevices.Internal ~/.julia/packages/MLDataDevices/gyWcF/src/internal.jl:112
┌ Warning: `acceleration isa CUDALibs` but no CUDA device (GPU) currently live.
└ @ MLJFlux ~/work/MLJFlux.jl/MLJFlux.jl/src/types.jl:62</code></pre><p>Notice that we specified to embed each of the columns to 2D columns. By default, it uses <code>min(numfeats - 1, 10)</code> for the new dimensionality of any categorical feature.</p><h3 id="Train-and-evaluate"><a class="docs-heading-anchor" href="#Train-and-evaluate">Train and evaluate</a><a id="Train-and-evaluate-1"></a><a class="docs-heading-anchor-permalink" href="#Train-and-evaluate" title="Permalink"></a></h3><pre><code class="language-julia hljs">mach = machine(clf, X_train, y_train)

fit!(mach, verbosity = 0)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">trained Machine; caches model-specific representations of data
  model: NeuralNetworkBinaryClassifier(builder = Short(n_hidden = 5, …), …)
  args: 
    1:	Source @427 ⏎ ScientificTypesBase.Table{Union{AbstractVector{ScientificTypesBase.Continuous}, AbstractVector{ScientificTypesBase.Multiclass{4}}, AbstractVector{ScientificTypesBase.Multiclass{3}}}}
    2:	Source @767 ⏎ AbstractVector{ScientificTypesBase.Multiclass{2}}
</code></pre><p>Get predictions on the training data</p><pre><code class="language-julia hljs">y_pred = predict_mode(mach, X_test)
balanced_accuracy(y_pred, y_test)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1.0</code></pre><p>Notice how the model has learnt to almost perfectly distinguish the classes and all the information has been in the categorical variables.</p><h3 id="Visualize-the-embedding-space"><a class="docs-heading-anchor" href="#Visualize-the-embedding-space">Visualize the embedding space</a><a id="Visualize-the-embedding-space-1"></a><a class="docs-heading-anchor-permalink" href="#Visualize-the-embedding-space" title="Permalink"></a></h3><pre><code class="language-julia hljs">mapping_matrices = MLJFlux.get_embedding_matrices(
                fitted_params(mach).chain,
                [1, 2],             # feature indices
                [:C1, :C2],         # feature names (to assign to the indices)
            )

C1_basis = mapping_matrices[:C1]
C2_basis = mapping_matrices[:C2]

p1 = scatter(C1_basis[1, :], C1_basis[2, :],
             title = &quot;C1 Basis Columns&quot;,
             xlabel = &quot;Column 1&quot;,
             ylabel = &quot;Column 2&quot;,
             label = &quot;C1 Columns&quot;,
             legend = :topright)

p2 = scatter(C2_basis[1, :], C2_basis[2, :],
             title = &quot;C2 Basis Columns&quot;,
             xlabel = &quot;Column 1&quot;,
             ylabel = &quot;Column 2&quot;,
             label = &quot;C2 Columns&quot;,
             legend = :topright)

c1_cats = [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;]
for (i, col) in enumerate(eachcol(C1_basis))
    annotate!(p1, col[1] + 0.1, col[2] + 0.1, text(c1_cats[i], :black, 8))
end

c2_cats = [&#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;]
for (i, col) in enumerate(eachcol(C2_basis))
    annotate!(p2, col[1] + 0.1, col[2] + 0.1, text(string(c2_cats[i]), :black, 8))
end

plot(p1, p2, layout = (1, 2), size = (1000, 400))</code></pre><img src="aa56d924.svg" alt="Example block output"/><p>As we can see, categories that were generated in a similar pattern were assigned similar vectors. In a dataset, where some columns have high cardinality, it&#39;s expected that some of the categories will exhibit similar patterns.</p><h3 id="Transform-(embed)-data"><a class="docs-heading-anchor" href="#Transform-(embed)-data">Transform (embed) data</a><a id="Transform-(embed)-data-1"></a><a class="docs-heading-anchor-permalink" href="#Transform-(embed)-data" title="Permalink"></a></h3><pre><code class="language-julia hljs">X_tr = MLJ.transform(mach, X);</code></pre><p>This will transform each categorical value into its corresponding embedding vector. Continuous value will remain intact.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../incremental_training/notebook/">« Incremental Training</a><a class="docs-footer-nextpage" href="../../hyperparameter_tuning/notebook/">Hyperparameter Tuning »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.13.0 on <span class="colophon-date" title="Saturday 21 June 2025 00:33">Saturday 21 June 2025</span>. Using Julia version 1.10.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
